{% extends "panel/base.html" %}


{% block title %}Configuraci√≥n - EcoRaci√≥n{% endblock %}

{% block content %}

<h1 class="page-title">Configuraci√≥n del Sistema</h1>

<form method="POST">
    {% csrf_token %}
    
    <div class="row g-4">

        <!-- ============================
            COLUMNA IZQUIERDA (Opciones)
        ============================= -->
        <div class="col-lg-6">

            <!-- Activar / Desactivar Notificaciones -->
            <div class="mb-3 d-flex justify-content-between align-items-center">
                <span>Notificaciones del sistema</span>
                <label class="switch">
                    <input type="checkbox" name="notificaciones" {% if config.notificaciones %}checked{% endif %}>
                    <span class="slider"></span>
                </label>
            </div>

            <!-- Alertas por baja producci√≥n -->
            <div class="mb-3 d-flex justify-content-between align-items-center">
                <span>Alertas de producci√≥n baja</span>
                <label class="switch">
                    <input type="checkbox" name="alertas" {% if config.alertas %}checked{% endif %}>
                    <span class="slider"></span>
                </label>
            </div>


            <!-- MODO OSCURO -->
            <div class="mb-4 d-flex justify-content-between align-items-center">
                <span>Modo oscuro</span>
                <label class="switch">
                    <input type="checkbox" name="modo_oscuro" {% if config.modo_oscuro %}checked{% endif %}>
                    <span class="slider"></span>
                </label>
            </div>

            <!-- CAMBIO DE IDIOMA -->
            <div class="mb-4">
                <label class="form-label">Idioma del sistema</label>
                <select class="form-select" name="idioma">
                    <option value="es" {% if config.idioma == 'es' %}selected{% endif %}>Espa√±ol</option>
                    <option value="en" {% if config.idioma == 'en' %}selected{% endif %}>Ingl√©s</option>
                </select>
            </div>

            <!-- VER PERFIL -->
            <a href="{% url 'perfil_usuario' %}" class="btn btn-outline-secondary w-100 mb-4">
                Ver perfil del usuario
            </a>

        </div>

        <!-- ============================
            COLUMNA DERECHA (Usuarios)
        ============================= -->
        <div class="col-lg-6">
            <h6>Usuarios con acceso</h6>
            <table class="table table-ecoracion mb-3">
                <thead>
                    <tr>
                        <th>Nombre</th>
                        <th>Usuario</th>
                        <th>Correo electr√≥nico</th>
                        <th style="width:70px;">Acci√≥n</th>
                    </tr>
                </thead>
                <tbody>
                    {% for u in usuarios %}
                    <tr>
                        <td>{{ u.first_name }}</td>
                        <td>{{ u.username }}</td>
                        <td>{{ u.email }}</td>
                        <td><span class="icon-delete">üóëÔ∏è</span></td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

    </div>

    <!-- BOT√ìN GUARDAR -->
    <div class="mt-3">
        <button type="submit" class="btn btn-ecoracion">Guardar cambios</button>
    </div>

</form>

{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function(){
    try {
        const checkbox = document.querySelector('input[name="modo_oscuro"]');
        if (!checkbox) return;

        // Priorizar el valor almacenado en localStorage (si existe)
        const stored = localStorage.getItem('modo_oscuro');
        if (stored === '1') {
            checkbox.checked = true;
            document.documentElement.classList.add('dark');
        } else if (stored === '0') {
            checkbox.checked = false;
            document.documentElement.classList.remove('dark');
        }

        // Cuando el usuario cambia el switch, actualizar visual y guardar preferencia
        checkbox.addEventListener('change', function(){
            if (checkbox.checked) {
                document.documentElement.classList.add('dark');
                localStorage.setItem('modo_oscuro', '1');
            } else {
                document.documentElement.classList.remove('dark');
                localStorage.setItem('modo_oscuro', '0');
            }
        });
    } catch(e) {
        // fail silently
        console.error(e);
    }
});
</script>
{% endblock %}
