{% extends "base.html" %}

{% block title %}Inicio - EcoRación{% endblock %}

{% block content %}
<h1 class="page-title">Inicio</h1>

<div class="row g-3 mb-3">

    <div class="col-md-4">
        <div class="metric-card">
            <h6>Ahorro mensual</h6>
            <span>{{ ahorro_mensual|default:"12%" }}</span>
        </div>
    </div>

    <div class="col-md-4">
        <div class="metric-card metric-card-secondary">
            <h6>Reducción de desperdicio</h6>
            <span>{{ desperdicio|default:"18 kg" }}</span>
        </div>
    </div>

    <div class="col-md-4">
        <div class="alerta-stock-card">
            <h6 class="mb-2">Alertas de Stock</h6>

            <div class="alerta-item">
                <div class="alerta-label">
                    <div class="alerta-icon-danger"></div>
                    <span>pellets: 12 kg</span>
                </div>
                <small>Bajo</small>
            </div>

            <div class="alerta-item mb-3">
                <div class="alerta-label">
                    <div class="alerta-icon-warning"></div>
                    <span>Carbonato: 3 kg</span>
                </div>
                <small>Crítico</small>
            </div>

        </div>
    </div>
</div>

<div class="row g-3">
    <div class="col-lg-8">
        <div class="card p-3">
            <h6 class="mb-3">Consumo vs Ahorro</h6>
            <canvas id="mainChart" style="max-height:300px;"></canvas>
        </div>
    </div>

    <div class="col-lg-4 d-flex align-items-center">
        <p class="text-muted mb-0">
            Gráfico comparativo del consumo mensual de alimento y el porcentaje de ahorro
            logrado al usar mezclas optimizadas con algas y carbonato de calcio.
        </p>
    </div>
</div>

{% endblock %}

{% block extra_js %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    const ctx = document.getElementById('mainChart');

    const dataConsumo = {{ datos_consumo|default:"[120,130,118]"|safe }};
    const dataAhorro = {{ datos_ahorro|default:"[8,12,15]"|safe }};

    if (ctx) {
        new Chart(ctx, {
            type: 'line',
            data: {
                labels: ['Ago', 'Sep', 'Oct'],
                datasets: [
                    {
                        label: 'Consumo (kg)',
                        data: dataConsumo,
                        tension: 0.3
                    },
                    {
                        label: 'Ahorro (%)',
                        data: dataAhorro,
                        tension: 0.3
                    }
                ]
            }
        });
    }
</script>
{% endblock %}
