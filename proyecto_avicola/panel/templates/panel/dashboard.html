{% extends "panel/base.html" %}

{% block title %}Inicio - EcoRaciÃ³n{% endblock %}

{% block content %}
<h1 class="page-title">Inicio</h1>

<div class="row g-3 mb-3">

    <div class="col-md-4">
        <div class="metric-card">
            <h6>Total insumos</h6>
            <span>{{ insumos|length }}</span>
        </div>
    </div>

    <div class="col-md-4">
        <div class="metric-card metric-card-secondary">
            <h6>Alertas activas</h6>
            <span>{{ alertas_stock|length }}</span>
        </div>
    </div>

    <div class="col-md-4">
        <div class="alerta-stock-card">
            <h6 class="mb-2">ðŸ“¦ Stock Actual</h6>

            {% if alertas_stock and alertas_stock|length > 0 %}
                {% for a in alertas_stock|slice:":3" %}
                    <div class="alerta-item">
                        <div class="alerta-label">
                            {% if a.nivel == 'CRITICO' or a.nivel == 'CrÃ­tico' %}
                                <div class="alerta-icon-danger"></div>
                            {% else %}
                                <div class="alerta-icon-warning"></div>
                            {% endif %}
                            <span>{{ a.nombre }}: {{ a.stock_actual }}</span>
                        </div>
                        <small>{{ a.nivel }}</small>
                    </div>
                {% endfor %}
                <div class="mt-2">
                    <a href="{% url 'stock' %}" class="small">Ver todos â†’</a>
                </div>
            {% else %}
                <p class="text-muted mb-0 small">Todos los insumos estÃ¡n en niveles normales.</p>
                <div class="mt-2">
                    <a href="{% url 'stock' %}" class="small">Ir a Stock â†’</a>
                </div>
            {% endif %}

        </div>
    </div>
</div>

<div class="row g-3">
    <div class="col-lg-8">
        <div class="card p-3">
            <h6 class="mb-3">Consumo vs Ahorro</h6>
            <canvas id="mainChart" style="max-height:300px;"></canvas>
        </div>
    </div>

    <div class="col-lg-4 d-flex align-items-center">
        <p class="text-muted mb-0">
            GrÃ¡fico comparativo del consumo mensual de alimento y el porcentaje de ahorro
            logrado al usar mezclas optimizadas con algas y carbonato de calcio.
        </p>
    </div>
</div>

{% endblock %}

{% block extra_js %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    const ctx = document.getElementById('mainChart');

    const dataConsumo = {{ datos_consumo|default:"[120,130,118]"|safe }};
    const dataAhorro = {{ datos_ahorro|default:"[8,12,15]"|safe }};

    if (ctx) {
        new Chart(ctx, {
            type: 'line',
            data: {
                labels: ['Ago', 'Sep', 'Oct'],
                datasets: [
                    {
                        label: 'Consumo (kg)',
                        data: dataConsumo,
                        tension: 0.3
                    },
                    {
                        label: 'Ahorro (%)',
                        data: dataAhorro,
                        tension: 0.3
                    }
                ]
            }
        });
    }
</script>
{% endblock %}
